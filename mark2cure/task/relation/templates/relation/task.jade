extends base

- load widget_tweaks
- load humanize


block header
  - with headerMessage=task.name
    include includes/header-relation


block content

  .container-fluid
    #quest-guide.row
      .col-xs-12.col-md-10.col-md-offset-1
        ul#progress-bar.list-unstyled.list-inline

    .row
      .col-xs-12.col-md-10.col-md-offset-1
        #tree-insert

    .row
      .col-xs-10.col-xs-offset-1.col-sm-10.col-sm-offset-1.col-md-4.col-md-offset-4
        button(id='submit_button', disabled).btn.btn-primary.btn-block.disabled Submit

    .row
      .col-xs-12.col-md-10.col-md-offset-1
        div(id="doc_{{document.pk}}", data-doc_pk="{{document.pk}}", data-pmid="{{document.document_id}}").document
          .paragraphs

    .row(style="display:none;")
      form(id="task_relation_results", action='{% url "task-relation:results" document_pk=document.pk %}', method='POST')
        - csrf_token

    .row.m-t-md
      .col-sm-5.col-md-3.col-md-offset-1.hidden-xs-down
        div(role="group").btn-group-vertical
          a(data-toggle="modal", data-target="#relationshipInstructionsModal", style='background-color:#fff; color:#7F3CFF; border-color:#7F3CFF; border-width:3px').btn.btn-default
            | Relation Instructions  <i class="fa fa-external-link fa-lg"></i>

          a(data-toggle="modal", data-target="#diseaseDefinitionsModal", style='background-color: #d1f3ff;').btn.btn-default
            | Disease Concept  <i class="fa fa-external-link fa-lg"></i>

          a(data-toggle="modal", data-target="#geneDefinitionsModal", style='background-color:rgb(177, 255, 168);').btn.btn-default
            | Genes Concept  <i class="fa fa-external-link fa-lg"></i>

          a(data-toggle="modal", data-target="#drugDefinitionsModal", style='background-color:rgb(255, 209, 220);').btn.btn-default
            | Drugs Concept  <i class="fa fa-external-link fa-lg"></i>


block post-footer

  <script type="html/template" id="tree-template">
  <div id="tree" class="row text-center">

  <div class="concept col-xs-10 col-xs-offset-1 col-sm-4 col-sm-offset-0 col-md-3" id="c1">
  <i id="c1_not_correct" class="fa fa-times-circle"></i>
  <h3><%= c1.text %></h3>
  <p class="not_correct_stype"></p>
  </div>

  <div class="col-xs-10 col-xs-offset-1 col-sm-4 col-sm-offset-0 col-md-6" style="padding-bottom:10px; padding-top:10px;">
  <h3 id="relation" class="disabled">Select a Relationship below...</h3>
  <ul class="list-group"></ul>
  </div>

  <div class="concept col-xs-10 col-xs-offset-1 col-sm-4 col-sm-offset-0 col-md-3" id="c2">
  <i id="c2_not_correct" class="fa fa-times-circle"></i>
  <h3><%= c2.text %></h3>
  <p class="not_correct_stype"></p>
  </div>

  </script>

  script.
    var relation_task_settings = {
      'csrf_token': "{{csrf_token}}",
      'document_pk': "{{ document.pk }}",
      'document_pmid': "{{ document.document_id }}"
    };
    $.getJSON('/static/js/tasks/relation-data.json', function(data) {
      relation_task_settings['data'] = data;
    });

    var passages, regions, tmp_passages;

    YPet.addInitializer(function(options) {

      $.getJSON('/document/pubtator/'+relation_task_settings.document_pmid+'.json', function( data ) {
        passages = data.collection.document.passage;
        regions = {};

        _.each(passages, function(passage, passage_idx) {
          var p_body = '<div id="'+ passage.infon[2]['#text'] +'" class="paragraph-box m-t-md"><p class="paragraph"></p></div></div>';
          $('.paragraphs').append(p_body);
          regions[''+passage_idx] = '#'+passage.infon[2]['#text'];
        });
        YPet.addRegions(regions);

        _.each(passages, function(passage, passage_idx) {
          var p = new Paragraph({'text': passage.text});
          YPet[''+passage_idx].show( new WordCollectionView({
            collection: p.get('words'),
          }) );
          YPet[''+passage_idx].currentView.drawBioC(null, true);
        });

      });
    });
    YPet.start();


  script(src="/static/js/libs/tree.js")
  script(src="/static/js/tasks/relation.js")
