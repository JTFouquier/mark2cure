extends base

- load widget_tweaks
- load brabeion_tags

block header
  - with headerMessage=task.name
    include includes/header-quest

block content
  .container-fluid
    div(style="background: #f5f5f5;").row
      .col-xs-6.col-xs-offset-1

        // Document header Information
        // 1) List of document Icons
        // 2) Ongoing score (live)
        // 3) Current Level (not live)
        .row.quest-guide
          - for doc in completed_doc_pks
            div.doc-item-col.col-xs-2.col-sm-1.text-center
              h4 &#8226;
          - for doc in uncompleted_docs
            div.doc-item-col.col-xs-2.col-sm-1.text-center
              h4 &#8226;

      .col-xs-2
        h4.pull-right Score: <span id='score'>#{user.userprofile.rating_score}</span>
      .col-xs-2
        h4 Level: #{user.userprofile.highest_level.name}

    .row
      div(id="doc_{{document.pk}}", data-doc_pk="{{document.pk}}", data-pmid="{{document.document_id}}").container.document
        .paragraphs

        // Hiden form in place to submit the document annotations
        div(style="display:none;")
          form(method="post", action="/document/{{task.pk}}/{{doc.pk}}/submit/")
            - csrf_token
            input(type="hidden", name="task_type", value="concept-recognition")


  .container.head-space
    .row
      .col-xs-3
        ul.list-unstyled
          li(style='background-color: #d1f3ff;')
            a(href='{% url "instructions:disease-marking" %}', target='_blank')
              p.text-center Disease Concept
          li(style='background-color: #d1ffdd;')
            a(href='{% url "instructions:gene-marking" %}', target='_blank')
              p.text-center Genes Concept
          li(style='background-color: #ffd1dc;')
            a(href='{% url "instructions:treatment-marking" %}', target='_blank')
              p.text-center Treatments Concept

      // Init all submission events
      // 1) Submit the document
      // 2) Go to next document (after review)
      // 3) Submit the Quest as complete
      div(style="padding-top:2px;").col-xs-4.col-xs-offset-1
        div(id="quest-submit").button.btn.btn-default.btn-block.done Submit


block post-footer
  script.
    var task_id = "{{ task.pk }}";

    YPet.addInitializer(function(options) {
      var $paragraphs = $('.paragraphs');

      var self_data;
      $.getJSON('/document/{{document.document_id}}.json', function( data ) {
        self_data = data;

        var passages = data.collection.document.passage;
        var regions = {};

        _.each(passages, function(passage, passage_idx) {
          var p_body = '<div id="'+ passage.infon[2]['#text'] +'" class="paragraph-box head-space"><p class="paragraph"></p></div></div>';
          $paragraphs.append(p_body);
          regions[''+passage_idx] = '#'+passage.infon[2]['#text'];
        });

        YPet.addRegions(regions);

        _.each(passages, function(passage, passage_idx) {
          var p = new Paragraph({'text': passage.text});
          YPet[''+passage_idx].show( new WordCollectionView({
            collection: p.get('words'),
            passage_json: passage,
            bioc_json: data
          }) );
        });

        /* Submit Feedback and show partner */
        /*
        $.getJSON('/static/bioc/training/exp-2-intro-4/step-5-partner.json', function( data ) {
          partner_data = data;
          var passages = data.collection.document.passage;
          _.each(passages, function(passage, passage_idx) {
            YPet[passage_idx].currentView.drawBioC(passage, true);
          });
        });
        */

      });
    });
    YPet.start();

